<!DOCTYPE html>
<html lang="en" data-theme="light">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>WHATTHEFIT</title>

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Funnel+Display:wght@300..800&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Barrio&display=swap" rel="stylesheet">

    <style>
      :root {
        --background-color:#1a1a1a; --text-color:#f0f0f0; --card-background:#2c2c2c;
        --feature-background:#333333; --input-background:#444; --border-color:#555;
        --primary-accent-color: #000;
        --primary-accent-hover: #333;
        --checkmark-color: #000;
      }
      [data-theme="light"]{
        --background-color:#f0f2f5; --text-color:#1c2121; --card-background:#fff;
        --feature-background:#fdfdfd; --input-background:#e4e6eb; --border-color:#ced0d4;
      }
      body{font-family:"Funnel Display",sans-serif;font-size:16px;background:var(--background-color);color:var(--text-color);
        margin:0;padding:20px;transition:.3s}
      .container{max-width:1200px;margin:auto;background:var(--card-background);padding:30px;border-radius:15px}
      h1{text-align:center;color:var(--primary-accent-color);font-family:"Barrio",system-ui;font-size:80px;transition:.3s}
      h2{text-align:center;color:var(--primary-accent-color);transition:.3s;}
      
      .feature-container { display: flex; gap: 20px; margin-bottom: 20px; }
      .control-panel { flex: 1; min-width: 320px; }
      .canvas { flex: 2; display: flex; flex-direction: column; min-width: 0; }
      .feature { background:var(--feature-background); padding:20px; border-radius:10px; box-sizing: border-box; display:flex; flex-direction:column; }
      .output-feature { flex-grow: 1; }
      .output { flex-grow: 1; overflow-y: auto; min-height: 0; }
      
      @media (max-width: 900px) { .feature-container { flex-direction: column; } }

      .theme-switcher{display:flex;justify-content:center;align-items:center;gap:15px;margin-bottom:30px;
        background:var(--feature-background);padding:10px;border-radius:10px}
      .theme-button {
        padding:8px 12px; border:1px solid var(--border-color); background-color:var(--input-background); color:var(--text-color); 
        border-radius:8px; cursor:pointer; font-family:"Funnel Display",sans-serif;
        transition: all 0.3s ease;
      }
      .theme-button:hover {
        background: var(--primary-accent-hover); color: #fff;
        box-shadow: 0 0 15px var(--primary-accent-hover), 0 0 25px var(--primary-accent-hover);
      }
      
      .color-input-wrapper{display:flex;align-items:center;gap:10px}
      .color-picker-label{position:relative;display:inline-block;width:30px;height:30px;cursor:pointer;border-radius:50%;border:1px solid var(--border-color)}
      input[type="color"]{opacity:0;width:100%;height:100%;cursor:pointer;position:absolute;top:0;left:0}
      
      label{display:block;margin-bottom:8px;font-weight:bold}
      select,.checkbox-group{width:100%;padding:10px;margin-bottom:15px;border-radius:8px;font-size:1em;
        border:1px solid var(--border-color);background:var(--input-background);color:var(--text-color);box-sizing:border-box}
      .color-selection-wrapper{position: relative; margin-bottom: 8px;}
      .checkbox-container{background:var(--input-background);padding:10px;border-radius:8px;margin-bottom:15px;
        border:1px solid var(--border-color)}
      .checkbox-group{display:flex;flex-wrap:wrap;gap:15px}
      .checkbox-group label{font-weight:normal;display:flex;align-items:center;gap:5px}
      
      .button-group{margin-bottom:20px; display:flex; flex-wrap:wrap; gap:8px;}
      .button-group button, .palette-generate-button {
        padding:8px 16px; border:none; border-radius:8px; cursor:pointer;
        background: var(--primary-accent-color);
        color:#fff; font-size:0.9em; font-family:"Funnel Display",sans-serif;
        font-weight:bold; margin-right:0; transition: all 0.3s ease;
      }
      .button-group button:hover:not(:disabled), .palette-generate-button:hover:not(:disabled){
        background: var(--primary-accent-hover);
        box-shadow: 0 0 15px var(--primary-accent-hover), 0 0 25px var(--primary-accent-hover);
      }
      .button-group button:disabled, .palette-generate-button:disabled{ background: #555 !important; cursor:not-allowed; opacity:.7; box-shadow: none;}
      
      .output{
        padding:15px; background:var(--card-background); border-radius:8px; white-space:pre-wrap;
        border:1px solid var(--border-color); line-height:1.6; font-size:1em;
      }

      .tabs { display: flex; gap: 10px; margin-bottom: 20px; border-bottom: 2px solid var(--border-color); }
      .tab-button { background: none; border: none; padding: 10px 15px; font-size: 1.1em; cursor: pointer; color: var(--text-color); opacity: 0.6; position: relative; }
      .tab-button.active { opacity: 1; font-weight: bold; }
      .tab-button.active::after { content: ''; position: absolute; bottom: -2px; left: 0; right: 0; height: 2px; background: var(--primary-accent-color); }
      .tab-content { display: none; }
      .tab-content.active { display: block; }
      
      .camera-container { position: relative; width: 100%; }
      #camera-feed { width: 100%; border-radius: 8px; background: #000; aspect-ratio: 4 / 3; display: block; }
      #capture-canvas { width: 100%; border-radius: 8px; aspect-ratio: 4 / 3; display: none; }
      #countdown-overlay {
        position: absolute; top: 0; left: 0; width: 100%; height: 100%;
        display: none; justify-content: center; align-items: center;
        font-size: 8rem; font-weight: bold; color: rgba(255, 255, 255, 0.9);
        -webkit-text-stroke: 2px black; text-stroke: 2px black;
        z-index: 10;
      }
      #label-overlay {
        position: absolute; top: 0; left: 0; right: 0; bottom: 0;
        pointer-events: none;
      }
      .outfit-label {
        position: absolute; display: flex; align-items: center;
        transform: translate(-50%, -50%);
        animation: fadeIn 0.5s ease-in-out;
      }
      @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
      .outfit-label .dot {
        width: 15px; height: 15px; background: var(--primary-accent-color);
        border-radius: 50%; border: 2px solid #fff;
        box-shadow: 0 0 10px rgba(0,0,0,0.5);
      }
      .outfit-label .line {
        width: 40px; height: 2px; background: #fff;
      }
      .outfit-label .text {
        padding: 5px 10px; background: rgba(0,0,0,0.7); color: #fff;
        border-radius: 5px; white-space: nowrap; font-size: 0.9em;
      }

      /* --- NEW TIMER STYLES --- */
      #timer-controls {
        display: none; /* JS toggles this */
        margin-top: 15px;
        padding-top: 15px;
        border-top: 1px solid var(--border-color);
        display: flex;
        justify-content: center;
        align-items: center;
        gap: 15px; /* Gap between "Timer:" and the buttons */
      }
      .timer-options-group {
        display: flex;
        gap: 8px; /* Gap between the buttons */
      }
      #timer-controls input[type="radio"] {
        display: none; /* Hide the actual radio button */
      }
      #timer-controls label {
        display: inline-block; /* Make label behave for padding */
        padding: 8px 16px;
        border: 1px solid var(--border-color);
        background-color: var(--input-background);
        color: var(--text-color);
        border-radius: 8px;
        cursor: pointer;
        font-family: "Funnel Display", sans-serif;
        font-weight: 500;
        transition: all 0.2s ease-in-out;
        user-select: none; /* Prevent text selection on click */
        margin: 0; /* Override default label margin */
      }
      #timer-controls input[type="radio"]:not(:checked) + label:hover {
        border-color: var(--primary-accent-color);
        background-color: var(--feature-background);
      }
      #timer-controls input[type="radio"]:checked + label {
        background-color: var(--primary-accent-color);
        color: #fff;
        border-color: var(--primary-accent-color);
        box-shadow: 0 0 10px var(--primary-accent-color);
      }
      /* --- END NEW TIMER STYLES --- */

      .palette-container{
        position: relative;
        margin-top:8px; padding:10px; background-color:var(--input-background); border-radius:8px; 
        min-height:50px; text-align:center;
      }
      .palette{position:relative; margin-top:8px; cursor:pointer; padding:5px; border-radius:5px; transition: background-color 0.2s; text-align:left;}
      .palette:hover{ background-color: var(--border-color); }
      .palette h4{margin:0 0 5px 0;font-size:0.9em;opacity:0.8;}
      .swatches{display:flex;gap:5px;}
      .swatch{width:25px;height:25px;border-radius:50%;border:1px solid var(--border-color);}
      .checkmark{
        display:none; position:absolute; right:10px; top:50%; transform:translateY(-50%); 
        font-size:1.5em; color: var(--checkmark-color);
        transition: color 0.3s;
      }
      .palette.selected .checkmark{display:block;}
    </style>
  </head>
  <body>
    <div class="container">
      <h1>WHATTHEFIT</h1>

      <div class="theme-switcher">
        <span>Theme:</span>
        <button id="light-mode-btn" class="theme-button">Light</button>
        <button id="dark-mode-btn" class="theme-button">Dark</button>
        <div class="color-input-wrapper">
          <span>Accent:</span>
          <label class="color-picker-label" id="accent-color-preview" style="background-color: #000000;">
            <input type="color" id="accent-color-picker" value="#000000">
          </label>
        </div>
      </div>

      <!-- Tab Buttons -->
      <div class="tabs">
        <button class="tab-button active" data-tab="0">Live Fit Check</button>
        <button class="tab-button" data-tab="1">Your Daily Outfits</button>
        <button class="tab-button" data-tab="2">Fashion Concept</button>
      </div>

      <!-- Live Fit Check Panel -->
      <div id="tab-content-0" class="tab-content active">
        <div class="feature-container">
          <div class="control-panel">
            <div id="feature0-inputs" class="feature">
              <h2>Live Fit Check</h2>
              <div class="camera-container">
                  <video id="camera-feed" playsinline></video>
                  <canvas id="capture-canvas"></canvas>
                  <div id="countdown-overlay"></div>
                  <div id="label-overlay"></div>
              </div>
              <!-- --- UPDATED TIMER HTML --- -->
              <div id="timer-controls">
                  <strong>Timer:</strong>
                  <div class="timer-options-group">
                      <input type="radio" name="timer" value="0" id="timer-off" checked>
                      <label for="timer-off">Off</label>

                      <input type="radio" name="timer" value="3" id="timer-3s">
                      <label for="timer-3s">3s</label>

                      <input type="radio" name="timer" value="5" id="timer-5s">
                      <label for="timer-5s">5s</label>

                      <input type="radio" name="timer" value="10" id="timer-10s">
                      <label for="timer-10s">10s</label>

                      <input type="radio" name="timer" value="15" id="timer-15s">
                      <label for="timer-15s">15s</label>
                  </div>
              </div>
              <!-- --- END UPDATED TIMER HTML --- -->
              <div class="button-group" style="justify-content: center; margin-top: 15px;">
                <button id="start-camera" data-original-text="Start Camera">Start Camera</button>
                <button id="capture-image" data-original-text="Analyze Outfit" disabled>Analyze Outfit</button>
              </div>
            </div>
          </div>
          <div class="canvas">
            <div id="feature0-output" class="feature output-feature">
              <div id="output0" class="output">Enable your camera and capture an image of your outfit. The AI will provide feedback and styling ideas.</div>
            </div>
          </div>
        </div>
      </div>
      
      <!-- Your Daily Outfits Panel -->
      <div id="tab-content-1" class="tab-content">
        <div class="feature-container">
          <div class="control-panel">
            <div id="feature1-inputs" class="feature">
              <h2>Your Daily Outfits</h2>
              <label for="style1">Style</label>
              <select id="style1">
                <option>Minimalist</option><option>Casual</option><option>Sporty</option><option>Gothic</option>
                <option>Classic</option><option>Punk</option><option>Futuristic</option><option>Y2K</option>
                <option>Formal</option><option>Vintage</option><option>Streetwear</option><option>Bohemia</option>
              </select>
              <label>Garment Type</label>
              <div class="checkbox-container">
                <div class="checkbox-group" id="garmentType1">
                  <label><input type="checkbox" value="Blazer">Blazer</label><label><input type="checkbox" value="Dress">Dress</label>
                  <label><input type="checkbox" value="Skirt">Skirt</label><label><input type="checkbox" value="Trousers">Trousers</label>
                  <label><input type="checkbox" value="Jumpsuit">Jumpsuit</label><label><input type="checkbox" value="Hoodie">Hoodie</label>
                  <label><input type="checkbox" value="Coat">Coat</label><label><input type="checkbox" value="Shirt">Shirt</label>
                  <label><input type="checkbox" value="T-Shirt">T-Shirt</label><label><input type="checkbox" value="Gown">Gown</label>
                  <label><input type="checkbox" value="Set">Set</label><label><input type="checkbox" value="Shoes">Shoes</label>
                </div>
              </div>
              <label for="bodyShape1">Body Shape</label>
              <select id="bodyShape1">
                <option>Hourglass</option><option>Apple</option><option>Pear (Triangle)</option>
                <option>Rectangle (Straight)</option><option>Inverted Triangle</option>
              </select>
              <label for="occasion1">Occasion</label>
              <select id="occasion1">
                <option>Casual</option><option>Formal</option><option>Performance</option><option>Editorial</option>
              </select>
              <label for="color1">Color</label>
              <div class="color-selection-wrapper">
                <label class="color-picker-label" id="color-preview1" style="background-color: #000000;">
                    <input type="color" id="color1" value="#000000">
                </label>
              </div>
              <div id="palette-container1" class="palette-container">
                  <button id="ok-color1" class="palette-generate-button">Generate Palettes</button>
              </div>
            </div>
          </div>
          <div class="canvas">
            <div id="feature1-output" class="feature output-feature">
              <div class="button-group">
                  <button id="generate1" data-original-text="Generate">Generate</button>
                  <button id="expand1" data-original-text="Expand" disabled>Expand</button>
                  <button id="mutate1" data-original-text="Mutate" disabled>Mutate</button>
                  <button id="copy1">Copy</button>
                  <button id="export1">Export</button>
                  <button id="clear1">Clear</button>
              </div>
              <div id="output1" class="output"></div>
            </div>
          </div>
        </div>
      </div>

      <!-- Fashion Concept Panel -->
      <div id="tab-content-2" class="tab-content">
        <div class="feature-container">
          <div class="control-panel">
            <div id="feature2-inputs" class="feature">
              <h2>Fashion Concept</h2>
               <label for="style2">Style</label>
              <select id="style2">
                <option>Minimalist</option><option>Casual</option><option>Sporty</option><option>Gothic</option>
                <option>Classic</option><option>Punk</option><option>Futuristic</option><option>Y2K</option>
                <option>Formal</option><option>Vintage</option><option>Streetwear</option><option>Bohemia</option>
              </select>
              <label>Garment Type</label>
              <div class="checkbox-container">
                <div class="checkbox-group" id="garmentType2">
                  <label><input type="checkbox" value="Blazer">Blazer</label><label><input type="checkbox" value="Dress">Dress</label>
                  <label><input type="checkbox" value="Skirt">Skirt</label><label><input type="checkbox" value="Trousers">Trousers</label>
                  <label><input type="checkbox" value="Jumpsuit">Jumpsuit</label><label><input type="checkbox" value="Hoodie">Hoodie</label>
                  <label><input type="checkbox" value="Coat">Coat</label><label><input type="checkbox" value="Shirt">Shirt</label>
                  <label><input type="checkbox" value="T-Shirt">T-Shirt</label><label><input type="checkbox" value="Gown">Gown</label>
                  <label><input type="checkbox" value="Set">Set</label><label><input type="checkbox" value="Shoes">Shoes</label>
                </div>
              </div>
              <label for="color2">Color</label>
              <div class="color-selection-wrapper">
                <label class="color-picker-label" id="color-preview2" style="background-color: #000000;">
                    <input type="color" id="color2" value="#000000">
                </label>
              </div>
              <div id="palette-container2" class="palette-container">
                  <button id="ok-color2" class="palette-generate-button">Generate Palettes</button>
              </div>
              <label for="climate2">Climate</label>
              <select id="climate2">
                <option>Hot / Humid</option><option>Mild</option><option>Cool / Cold</option>
                <option>Rain</option><option>Donâ€™t mind, as long as the fit is cool</option>
              </select>
            </div>
          </div>
          <div class="canvas">
            <div id="feature2-output" class="feature output-feature">
              <div class="button-group">
                  <button id="generate2" data-original-text="Generate">Generate</button>
                  <button id="expand2" data-original-text="Expand" disabled>Expand</button>
                  <button id="mutate2" data-original-text="Mutate" disabled>Mutate
